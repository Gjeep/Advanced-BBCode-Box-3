<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en">Advanced BBCode Box 3 (aka ABBC3) - Add-on : This file provides instructions for install 2 add-on for ed2k in your forum.</title>

		<description lang="en">This file provides instructions for install 2 add-on for ed2k in your forum
		See the main install file for any additional information about the MOD.</description>

		<author-notes lang="en"><![CDATA[You will have to make this change to ALL themes you have installed, based off Prosilver and Subsilver2.
	-------------------------------------------------------------------
	IMPORTANT !
	
	Before made any changes, makes sure your template is stored into "filesystem"
	    ACP -> STYLES -> STYLE COMPONENTS -> Templates : subsilver2 -> Details
	
	If you do not want to change from "Database" to "Filesystem",
	you must do next changes within your ACP :
	    ACP -> STYLES -> STYLE COMPONENTS -> Templates : subsilver2 -> Edit
	
	-------------------------------------------------------------------]]>
		</author-notes>
	
		<author-group>
			<author>
				<realname>Gabriel</realname>
				<username>leviatan21</username>
				<email>info@mssti.com</email>
				<homepage>http://www.mssti.com/phpbb3/</homepage>
				<contributions-group>
					<contributions status="current" from="2008-01-10" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>
		
		<mod-version>3.0.6</mod-version>
		
		<installation>
			<level>easy</level>
			<time>120</time>
			<target-version>3.0.6</target-version>
		</installation>

		<link-group>
			<link type="parent"  href="../install_ABBC3_v306.xml" lang="en">Code change</link>
		</link-group>
	</header>

	<action-group>
		
		<open src="viewtopic.php">
			<edit>
				<comment lang="en">Make ed2k links work directly ( without [url] tag ) - Step 1 of 1</comment>
				<find><![CDATA[	// Dump vars into template
	$template->assign_block_vars('postrow', $postrow);]]></find>
				<action type="before-add"><![CDATA[
// MOD : MSSTI ABBC3 (V3.0.6) add-on : magic urls eD2k links processing - START
	if ( @$config['ABBC3_MOD'] )
	{
		if ( strpos($postrow['MESSAGE'], "ed2k://") !== false )
		{
			$magic_url_match[] = '#<!-- ([lmwe]) --><a class="(.*?)" href="(ed2k://(.*?))">(.*?)</a><!-- ([lmwe]) -->#ie';
			$magic_url_replace[] = "abbc3_ed2k_make_clickable( '\$3' )";

			$postrow['MESSAGE'] = preg_replace($magic_url_match, $magic_url_replace, $postrow['MESSAGE']);
		}
	}
// MOD : MSSTI ABBC3 (V3.0.6) add-on : magic urls eD2k links processing - End
]]></action>
			</edit>
		</open>

		<open src="viewtopic.php">
			<edit>
				<comment lang="en">Make a table at the end of the post for download all the ed2k links in-one-click - Step 1 of 2</comment>
				<find><![CDATA[	// Dump vars into template
	$template->assign_block_vars('postrow', $postrow);]]></find>
				<action type="after-add"><![CDATA[
// MOD : MSSTI ABBC3 (V3.0.6) eD2k Add all links feature - START
	if ( @$config['ABBC3_MOD'] )
	{
		if ( strpos($message, "ed2k://") !== false )
		{
			abbc3_ed2k_add_all_ed2k_link($message, $row['post_id']);
		}
	}
// MOD : MSSTI ABBC3 (V3.0.6) eD2k Add all links feature - End
]]></action>
			</edit>
		</open>

		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<comment lang="en">Make a table at the end of the post for download all the ed2k links in-one-click - Step 2 of 2</comment>
				<find><![CDATA[			<!-- IF postrow.S_DISPLAY_NOTICE --><div class="rules">{L_DOWNLOAD_NOTICE}</div><!-- ENDIF -->]]></find>
				<action type="before-add"><![CDATA[
<!-- MOD : MSSTI ABBC3 (V3.0.6) add-on eD2k Add all links feature - Start //-->
			<!-- IF ALL_ED2K_LINK -->
				<!-- BEGIN ed2k -->
				<br />
				<hr />
				<div class="ed2k_div1"><a href="javascript:abbc3_toggle('posttable{postrow.ed2k.ED2K_ID}');">{postrow.ed2k.ED2K_TEXT1}</a></div>
				<div id="posttable{postrow.ed2k.ED2K_ID}" class="ed2k_div2">
					<dl class="ed2k_table">
						<!-- BEGIN row -->
						<dd><input type="checkbox" name="lnk{postrow.ed2k.ED2K_ID}" value="{postrow.ed2k.row.LINK_VALUE}" />{postrow.ed2k.row.LINK_TEXT}</dd>
						<!-- END row -->
						<dd style="text-align:center;"><input type="button" value="{postrow.ed2k.ED2K_TEXT2}" class="button2" onclick="checkAll('lnk{postrow.ed2k.ED2K_ID}')" />&nbsp;&nbsp;<input type="button" value="{postrow.ed2k.ED2K_TEXT3}" class="button2" onclick="download('lnk{postrow.ed2k.ED2K_ID}',0,1)" /></dd>
					</dl>
				</div>
				<!-- END ed2k -->
			<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 (V3.0.6) add-on eD2k Add all links feature - End //-->
]]></action>
			</edit>
		</open>

		<open src="styles/subsilver2/template/viewtopic_body.html">
			<edit>
				<comment lang="en">Make a table at the end of the post for download all the ed2k links in-one-click - Step 2 of 2</comment>
				<find><![CDATA[			<!-- IF postrow.S_DISPLAY_NOTICE -->]]></find>

				<action type="before-add"><![CDATA[
<!-- MOD : MSSTI ABBC3 (V3.0.6) add-on eD2k Add all links feature - Start //-->
				<!-- IF ALL_ED2K_LINK -->
					<!-- BEGIN ed2k -->
					<br />
					<hr />
					<div class="ed2k_div1"><a href="javascript:abbc3_toggle('posttable{postrow.ed2k.ED2K_ID}');">{postrow.ed2k.ED2K_TEXT1}</a></div>
					<div id="posttable{postrow.ed2k.ED2K_ID}" class="ed2k_div2">
						<table border="0" cellspacing="0" cellpadding="0" class="ed2k_table" width="100%">
						<!-- BEGIN row -->
							<tr>
								<td class="ed2k_col1"><input type="checkbox" name="lnk{postrow.ed2k.ED2K_ID}" value="{postrow.ed2k.row.LINK_VALUE}" /></td>
								<td class="ed2k_col2">{postrow.ed2k.row.LINK_TEXT}</td>
							</tr>
						<!-- END row -->
							<tr>
								<td colspan="2" class="ed2k_col1"><input type="button" value="{postrow.ed2k.ED2K_TEXT2}" class="button2" onclick="checkAll('lnk{postrow.ed2k.ED2K_ID}')" />&nbsp;&nbsp;<input type="button" value="{postrow.ed2k.ED2K_TEXT3}" class="button2" onclick="download('lnk{postrow.ed2k.ED2K_ID}',0,1)" /></td>
							</tr>
						</table>
					</div>
					<!-- END ed2k -->
				<!-- ENDIF -->
<!-- // MOD : MSSTI ABBC3 (V3.0.6) add-on eD2k Add all links feature - End -->
]]></action>
			</edit>
		</open>

		<diy-instructions lang="en"><![CDATA[IMPORTANT !

OVERWRITE all your previous files with the new ones!
Please make sure of it, some FTP programs don't do it fine.

#####################################################################
Log on to Administration Control Panel

#####################################################################
A) Purge the cache :

	A.1) Navigate to General Tab
	A.2) look at Purge the cache
	A.3) Click on "Run Now" button at right
	A.4) in the next screen, click on "Yes"

#####################################################################
B) Refresh the templates :

	B.1) Navigate to "Styles" Tab.
	B.2) Under "Style components " click on "Templates".
	B.3) Under "Actions" click on "Refresh".
	B.4) in the next screen, click on "Yes" ( Repeat last 2 steps to each instaled style ).
]]>
		</diy-instructions>

	</action-group>
</mod>