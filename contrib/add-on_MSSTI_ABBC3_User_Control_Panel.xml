<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>

		<title lang="en"><![CDATA[Advanced BBCode Box 3 (aka ABBC3) Add-on : User Control Panel.]]></title>

		<description lang="en"><![CDATA[This file provides instructions to add options to the UCP so your users can change two of the ABBC3 settings. Users will have the option to turn the ABBC3 toolbar on/off and you can also give your users the option to use ABBC3's Compact view or Default view.

		See the main install file for any additional information about the MOD.]]></description>

		<author-notes lang="en"><![CDATA[To read more about ABBC3, please read the contrib/docs/README.HTML file

	-------------------------------------------------------------------
	NOTE: This addition is optional - and you don't need to install the Add-on : Compact View

	Create 2 options in the "UCP -> PROFILE -> Edit posting defaults" settings :
		1) The user is able to choose to disable the ABBC3 toolbar or use the default phpBB3 buttons
		2) If the ABBC3 toolbar is enabled the user is able to choose “Compact view” or “Full view”. The “Compact view” will display all BBcodes in a neat drop-down menu for a much cleaner and compact appearance.

		   To see example screenshots of “Compact view” :
			root/contrib/screenshots/Prosilver_posting_default.gif against root/contrib/screenshots/Prosilver_posting_compactview.gif
		     or
			root/contrib/screenshots/Subsilver2_posting_default.gif against root/contrib/screenshots/Subsilver2_posting_compactview.gif

	]]></author-notes>

		<author-group>
			<author>
				<realname>Gabriel</realname>
				<username>leviatan21</username>
				<email>info@mssti.com</email>
				<homepage>http://www.mssti.com/phpbb3/</homepage>
				<contributions-group>
					<contributions status="current" from="2008-01-10" position="Developer"/>
				</contributions-group>
			</author>
		</author-group>

		<mod-version>3.0.7-PL1</mod-version>

		<installation>
			<level>easy</level>
			<time>120</time>
			<target-version>3.0.7-PL1</target-version>
		</installation>

		<link-group>
			<link type="parent"  href="../install_ABBC3.xml" lang="en">Code change</link>
		</link-group>
	</header>

	<action-group>

		<php-installer><![CDATA[install_abbc3.php]]></php-installer>

		<open src="includes/functions_display.php">
			<edit>
				<find><![CDATA[// MOD : MSSTI ABBC3 - Start
	global $config, $mode, $abbcode;]]></find>
				<action type="after-add"><![CDATA[
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start
	// Redefine the use of ABBC3 according this user preferences
	$abbc3 = (isset($user->data['user_abbcode_mod'])) ? $user->data['user_abbcode_mod'] : $abbc3;
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start

]]></action>
			</edit>

			<edit>
				<remove><![CDATA[// MOD : MSSTI ABBC3 (custom profile fields) - Start
	if ($abbc3 && @$config['ABBC3_MOD'])
	{
		// Load custom profile fields
		if (!class_exists('custom_profile'))
		{
			global $phpbb_root_path, $phpEx;
			include($phpbb_root_path . 'includes/functions_profile_fields.' . $phpEx);
		}
		$abbcode_cp = new custom_profile();

		// Grab all profile fields from users in id cache for later use - similar to the poster cache
		$abbcode_cpf = $abbcode_cp->generate_profile_fields_template('grab', $user->data['user_id']);

		// Redefine the use of ABBC3 according this user preferences
		$abbc3 = (isset($abbcode_cpf[$user->data['user_id']]['abbc_mod']['value'])) ? (($abbcode_cpf[$user->data['user_id']]['abbc_mod']['value'] == 1) ? true : false ) : $abbc3;

		// Define the ABBC3 view, according this user preferences
		global $abbcode_compact;
		$abbcode_compact = (isset($abbcode_cpf[$user->data['user_id']]['abbc_short']['value'])) ? (($abbcode_cpf[$user->data['user_id']]['abbc_short']['value'] == 1) ? true : false ) : false;
	}
// MOD : MSSTI ABBC3 (custom profile fields) - End]]></remove>
				<comment lang="en">If you don't find the next line, don't worry probably you never install the "Add-On : Custom User Profile Options". Procede with the next step.</comment>
			</edit>
		</open>

		<open src="includes/ucp/ucp_prefs.php">
			<edit>
				<find><![CDATA['notify'	=> request_var('notify', (bool) $user->data['user_notify']),]]></find>
				<action type="after-add"><![CDATA[
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start
					'abbcode_mod'		=> request_var('abbcode_mod', (bool) (isset($user->data['user_abbcode_mod'])) ? $user->data['user_abbcode_mod'] : true),
					'abbcode_compact'	=> request_var('abbcode_compact', (bool) (isset($user->data['user_abbcode_compact'])) ? $user->data['user_abbcode_compact'] : false),
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - End
]]></action>
			</edit>

			<edit>
				<find><![CDATA['user_notify'	=> $data['notify'],]]></find>
				<action type="after-add"><![CDATA[
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start
							'user_abbcode_mod'		=> $data['abbcode_mod'],
							'user_abbcode_compact'	=> $data['abbcode_compact'],
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - End
]]></action>
			</edit>

			<edit>
				<find><![CDATA[				$template->assign_vars(array(
					'S_BBCODE'	=> $data['bbcode'],]]></find>
				<action type="before-add"><![CDATA[
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start
					$user->add_lang('mods/acp_abbcodes');
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - End

]]></action>
			</edit>

			<edit>
				<find><![CDATA[					'S_SMILIES'	=> $data['smilies'],]]></find>
				<action type="before-add"><![CDATA[
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - Start
					'S_ABBC3_MOD'		=> @$config['ABBC3_MOD'],
					'S_ABBC3_VERSION'	=> @$config['ABBC3_VERSION'],
					'S_ABBCODE_MOD'		=> $data['abbcode_mod'],
					'S_ABBCODE_COMPACT'	=> $data['abbcode_compact'],
// MOD : MSSTI ABBC3 (Add-on : User Control Panel) - End
]]></action>
			</edit>

		</open>

		<open src="styles/prosilver/template/ucp_prefs_post.html">
			<edit>
				<find><![CDATA[<fieldset class="submit-buttons">]]></find>
				<action type="before-add"><![CDATA[

<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} (Add-on : User Control Panel) - Start //-->
<!-- IF S_ABBC3_MOD -->
<h2>{L_UCP_ABBCODES}</h2>
<div class="panel">
	<div class="inner"><span class="corners-top"><span></span></span>

	<fieldset>
	<dl>
		<dt><label for="abbcode_mod1">{L_UCP_ABBC3_SETTINGS}:</label><br /><span>{L_UCP_ABBC3_SETTINGS_EXPLAIN}</span></dt>
		<dd>
			<label for="abbcode_mod1"><input type="radio" name="abbcode_mod" id="abbcode_mod1" value="1"<!-- IF S_ABBCODE_MOD --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
			<label for="abbcode_mod0"><input type="radio" name="abbcode_mod" id="abbcode_mod0" value="0"<!-- IF not S_ABBCODE_MOD --> checked="checked"<!-- ENDIF --> /> {L_NO}</label>
		</dd>
	</dl>
	<dl>
		<dt><label for="abbcode_compact0">{L_UCP_ABBC3_BBCODES}:</label><br /><span>{L_UCP_ABBC3_BBCODES_EXPLAIN}</span></dt>
		<dd>
			<label for="abbcode_compact1"><input type="radio" name="abbcode_compact" id="abbcode_compact1" value="1"<!-- IF S_ABBCODE_COMPACT --> checked="checked"<!-- ENDIF --> /> {L_YES}</label> 
			<label for="abbcode_compact0"><input type="radio" name="abbcode_compact" id="abbcode_compact0" value="0"<!-- IF not S_ABBCODE_COMPACT --> checked="checked"<!-- ENDIF --> /> {L_NO}</label>
		</dd>
	</dl>
	</fieldset>
	
	<span class="corners-bottom"><span></span></span></div>
</div>
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} (Add-on : User Control Panel) - End //-->
]]></action>
			</edit>

		</open>

		<open src="styles/subsilver2/template/ucp_prefs_post.html">
			<edit>
				<find><![CDATA[<tr>
	<td class="cat" colspan="2" align="center">{S_HIDDEN_FIELDS}<input class="btnmain" type="submit" name="submit" value="{L_SUBMIT}" />&nbsp;&nbsp;<input class="btnlite" type="reset" value="{L_RESET}" name="reset" /></td>]]></find>
				<action type="before-add"><![CDATA[

<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} (Add-on : User Control Panel) - Start //-->
<!-- IF S_ABBC3_MOD -->
<tr>
	<th colspan="2">{L_UCP_ABBCODES}</th>

</tr>
<tr>
	<td class="row1" width="35%"><b class="genmed">{L_UCP_ABBC3_SETTINGS}:</b><br /><span class="gensmall">{L_UCP_ABBC3_SETTINGS_EXPLAIN}</span></td>
	<td class="row2"><input type="radio" class="radio" name="abbcode_mod" id="abbcode_mod1" value="1"<!-- IF S_ABBCODE_MOD --> checked="checked"<!-- ENDIF --> /><span class="gen">{L_YES}</span>&nbsp; &nbsp;<input type="radio" class="radio" name="abbcode_mod" id="abbcode_mod0" value="0"<!-- IF not S_ABBCODE_MOD --> checked="checked"<!-- ENDIF --> /><span class="gen">{L_NO}</span></td>
</tr>
<tr>
	<td class="row1" width="35%"><b class="genmed">{L_UCP_ABBC3_BBCODES}:</b><br /><span class="gensmall">{L_UCP_ABBC3_BBCODES_EXPLAIN}</span></td>
	<td class="row2"><input type="radio" class="radio" name="abbcode_compact" id="abbcode_compact1" value="1"<!-- IF S_ABBCODE_COMPACT --> checked="checked"<!-- ENDIF --> /><span class="gen">{L_YES}</span>&nbsp; &nbsp;<input type="radio" class="radio" name="abbcode_compact" id="abbcode_compact0" value="0"<!-- IF not S_ABBCODE_COMPACT --> checked="checked"<!-- ENDIF --> /><span class="gen">{L_NO}</span></td>
</tr>
<!-- ENDIF -->
<!-- MOD : MSSTI ABBC3 {S_ABBC3_VERSION} (Add-on : User Control Panel) - End //-->
]]></action>
			</edit>

		</open>

		<diy-instructions lang="en"><![CDATA[IMPORTANT !

#####################################################################
A) Database update :

	A.1) Once all the files have been modified and uploaded to your site,
	you should point your browser at this location with the addition 
	of /install_abbc3.php
	For example if your domain name is www.mydomain.tld and you placed phpBB3 
	in a directory /phpBB3 off your web root you would enter 
	http://www.mydomain.tld/phpBB3/install_abbc3.php into your browser.
	A.2) When you have done this you should see the phpBB3 ABBC3 Installation screen appear
	A.3) Undern the EXTRAS select "User Control Panel".
	If the installation was successful, you can now use your forum.
	Congratulations, you have installed phpBB3 ABBC3 "User Control Panel" successfully. 
	B.3) You should remove/rename the install file (root/install_abbc3.php) 
	from your server.

#####################################################################
B) Refresh the templates :

	B.1) Navigate to "Styles" Tab.
	B.2) Under "Style components " click on "Templates".
	B.3) Under "Actions" click on "Refresh".
	B.4) in the next screen, click on "Yes" ( Repeat last 2 steps to each instaled style ).

#####################################################################
C) Purge the cache :

	C.1) Navigate to General Tab
	C.2) look at Purge the cache
	C.3) Click on "Run Now" button at right
	C.4) in the next screen, click on "Yes"

#####################################################################
D) Enjoy it !.]]>
		</diy-instructions>

	</action-group>
</mod>