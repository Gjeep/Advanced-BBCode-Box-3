// <![CDATA[

/** AdvancedBox JS - Start
* This work is open source
* AdvancedBox for resized images based on "Reimg Image Resizer (+ lightbox)" from http://www.taletn.com/ - http://www.phpbb.com/community/viewtopic.php?f=70&t=907805
* Paked with : A JavaScript Compressor.  version 3.0 - http://dean.edwards.name/packer/
*
* eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('u 2x=1d x(){u j=21;u k,I,X,16,J,F,v,8,y,K=1r;u l,U=0;u m,17=0;u n=10;u o=0;u p,1e=B=1r;u q,18,19,D,1s=1r;u r=1d 1t();u s=1d 1t();22=x(){u a=G.1F.1G.1H(/(^|\\W)(23)\\s+(\\d+)(\\.\\d+)?/);9(!a){a=G.1F.1G.1H(/(^|\\W)(24|25|26)\\/(\\d+)(\\.\\d+)?/);9(!a){a=G.1F.1G.1H(/(^|\\W)(27)\\/[\\d.]+\\s+\\(.*?2y:(\\d+)(\\.\\d+)?.*?\\)/)}}9(!a||a.1u<5){V}u b=2z(a[3]+a[4]);a=a[2];9(a=="23"){B=b}C 9(a=="24"){u c=b}C 9(a=="25"){u d=b}C 9(a=="26"){u e=b}C 9(a=="27"){u f=b}p=(B&&B<=7.0)?28:12;1e=(B>=7.0||c>3.0)?28:12},1f=x(a,b,c,d){9(!I){29()}I.6.H="";X.6.H="";a=1v(a);K=1d 2A();K.L(\'13\',a);b=K.z;c=K.A;1w=G.1I("1J();",1);V 12},1v=x(a){a=2B(a.2C().1n(/\\s/g,\' \'));9(a.1o(\'2D\')!=-1){u b=a.1K(0,a.1o(\'?\'));u c=a.1K(a.1o(\'O\'));u d=c.1K(c.1o(\'O\'),c.1o(\'&\'));a=b+\'?\'+(d?d:c)}V a},1J=x(){o++;9(o==2E){1x(1w);1g()}9(!K.2F=="2a"||!K.2a){9(K.z>1y){1p(K.13,K.z,K.A,n)}C{1w=G.1I("1J();",2G)}}C{1x(1w);1p(K.13,K.z,K.A,n)}},29=x(){u a=1L();u b=1M();1z=t.2H("E").2I(0);I=t.P("2b");I.1A="2J";I.6.H="1a";I.6.2K=\'2L(2c:\'+j+\')\';I.6.2M=I.6.2N=I.6.2c=(j/1y);I.6.z="1y%";I.6.A=b[2]+"w";X=t.P("a");X.L(\'O\',\'2O\');X.14=X.15=2d;X.Q=1g;v=t.P("1N");v.6.H="1a";v.6.2e=(p?\'2f\':\'2P\');F=t.P("1N");F.L(\'O\',\'2Q\');F.6.2e=(1e?\'2R\':\'2f\');16=t.P("a");16.L(\'O\',\'2S\');16.14=16.15=2d;16.Q=1g;J=t.P("a");J.L(\'O\',\'2T\');J.Q=1O;D=t.P("a");D.L(\'O\',\'1P\');D.14=D.15=2g;D.Q=x(){1h(\'1B\');V 12};q=t.P("a");q.L(\'O\',\'2U\');18=t.P("1N");18.L(\'O\',\'2V\');19=t.P("a");19.L(\'O\',\'2W\');8=t.P("2b");y=t.P("2X");y.1A=8.1A=v.1A="2Y";y.Q=1g;1z.T(I);1z.T(X);F.T(16);F.T(J);F.T(D);F.T(q);F.T(18);F.T(19);v.T(F);8.T(y);v.T(8);1z.T(v)},2h=x(){u a=1L();u b=1M();l=b[3]-20;l=(1e)?(l+20):l;l=(B&&B<7.0)?l+10:l;U=b[4]+20;U=(1e)?(U-21):U;U=(B&&B<7.0)?U-30:U;v.6.Y=(!p?0:a[1])+"w";v.6.M=(!p?0:a[2])+"w"},1p=x(a,b,c,d){X.6.H="1a";G.2i=2j;2h();1Q(\'2k\');2l.2Z();8.6.2m="";y.L(\'13\',a);y.6.z=8.6.z=(m=b)+"w";y.6.A=8.6.A=(17=c)+"w";v.6.H="";v.6.z=v.6.A=8.6.Y=8.6.M="";u e=0;9(v.N>l&&b){e=b;b-=v.N-l+1;c=1b.1R(c*b/e);y.6.z=8.6.z=b+"w";y.6.A=8.6.A=c+"w"}9(v.1i>U&&c){e=c;c-=v.1i-U;b=1b.1R(b*c/e);y.6.z=8.6.z=b+"w";y.6.A=8.6.A=c+"w";9(v.N>l&&b){e=b;b-=v.N-l;c=1b.1R(c*b/e);y.6.z=8.6.z=b+"w";y.6.A=8.6.A=c+"w"}}9(e){J.14=J.15=31.1n(/%1\\$s/,m).1n(/%2\\$s/,17);J.Q=1O}C{J.14=J.15=2n;J.Q=1S}v.6.z=l+"w";v.6.A=U+"w";8.6.Y=1b.1C((v.N-8.N)/2-8.1j)+"w";8.6.M=1b.1C((v.1i-8.1i)/2-8.32)+"w";8.6.M=(B&&B<7.0)?(Z(8.6.M)+20)+"w":8.6.M;F.6.Y=(Z(8.1j))+"w";F.6.M=(Z(8.6.M)+(B&&B<7.0?-20:10))+"w";1h();n=d;9(n>=1y){1T()}},1h=x(a,b){q.6.H="1a";18.6.H="1a";19.6.H="1a";u c=y.13;u d=33(c,r);u e=d[0];u f=d[1];u g=r.1u;9(e){u h=r[f-1];u i=r[f+1];9(f-1>=0){q.6.H="";q.Q=x(){1f(h);V 12}}18.6.H="";18.34=35.1n(/%1\\$s/,f+1).1n(/%2\\$s/,g);9(f+1<g){19.6.H="";19.Q=x(){1f(i);V 12}}9(a&&2o(a)!="36"){9(!b&&f+1==g){b=1;1U=r[0]}C{b=f+1;1U=i}9(a==\'1B\'&&b<g){D.L(\'O\',\'37\');D.14=D.15=38;D.Q=x(){1h(\'39\');V 12};1f(1U);1s=G.1I("1h(\'1B\', \'"+b+"\');",(3a))}C{D.L(\'O\',\'1P\');D.14=D.15=2g;D.Q=x(){1h(\'1B\');V 12};1x(1s)}}}},1g=x(e){1Q(\'2p\');2l.3b();G.2i=1r;1x(1s);D.L(\'O\',\'1P\');y.L(\'13\',3c);I.6.H=v.6.H=X.6.H="1a"},2j=x(e){u a=y.13;1g();1p(a,m,17,n)},1S=x(e){1p(y.13,m,17,10)},1O=x(e){1T()},1T=x(){9(Z(y.6.z)>=m&&Z(y.6.A)>=17){V}y.6.z=m+"w";y.6.A=17+"w";8.6.2m="2q";9(!p){8.6.M=8.6.Y=v.6.A=0;8.6.z="2q"}C{u a=8.N-8.1q;8.6.M=8.6.Y=v.6.A=0;8.6.z=(l-2*8.1j-a)+"w";9(v.N>l){8.6.z=(l-(v.N-l))+"w"}}8.6.Y=1b.1C((v.N-8.N)/2-8.1j)+"w";8.6.M=Z(8.6.M)+((B&&B<7.0)?30:0)+"w";9(8.1q>m){8.6.z=m+"w";8.6.z=(m+(m-8.1q))+"w";8.6.Y=1b.1C((v.N-8.N)/2-8.1j)+"w"}8.6.A=Z(8.6.A)+(1e?+3d:0)+"w";9(8.1k){8.1k=0}9(8.1l){8.1l=0}J.14=J.15=2n;J.Q=1S;F.6.Y=(Z(8.1j))+"w";F.6.M=(Z(8.6.M)+(B&&B<7.0?-20:10))+"w"},1M=x(){u a,1m;9(G.1D&&G.2r){a=t.E.2s;1m=G.1D+G.2r}C 9(t.E.2t>t.E.1i){a=t.E.2s;1m=t.E.2t}C{a=t.E.N;1m=t.E.1i}u b,1c;9(1V.1D){b=1V.3e;1c=1V.1D}C 9(t.11&&t.11.1W){b=t.11.1q;1c=t.11.1W}C 9(t.E){b=t.E.1q;1c=t.E.1W}9(1m<1c){1X=1c}C{1X=1m}9(a<b){1Y=b}C{1Y=a}V 1d 1t(\'\',1Y,1X,b,1c)},1L=x(){u a=0;u b=0;9(2o(G.2u)==\'3f\'){b=G.2u;a=G.3g}C 9(t.E&&(t.E.1k||t.E.1l)){b=t.E.1l;a=t.E.1k}C 9(t.11&&(t.11.1k||t.11.1l)){b=t.11.1l;a=t.11.1k}V 1d 1t(\'\',a,b)},1Q=x(a){9(B){9(a!=\'2p\'){a=\'2k\'}2v(u S=0;S<t.1E.1u;S++){2v(u R=0;R<t.1E[S].1u;R++){9(t.1E[S].2w[R].3h){t.1E[S].2w[R].6.3i=a}}}}};22();1Z.3j=r;1Z.1f=1f;1Z.1v=1v};',62,206,'||||||style||objImageContainer|if||||||||||||||||||||document|var|objContainer|px|function|objImage|width|height|msie|else|objPlay|body|objToolbar|window|display|objOverlay|objZoom|newObjImage|setAttribute|top|offsetWidth|id|createElement|onclick|||appendChild|MaxHeight|return||objLoading|left|parseInt||documentElement|false|src|alt|title|objCloser|RealImgHeight|objText|objNext|none|Math|windowHeight|new|NewStyle|Show|Close|Slide_Show|offsetHeight|offsetLeft|scrollLeft|scrollTop|yScroll|replace|indexOf|ShowImage|clientWidth|null|SlideWait|Array|length|Clear_url|imgWait|clearTimeout|100|objBigBody|className|play|floor|innerHeight|forms|navigator|userAgent|match|setTimeout|waitFor|substring|getScrollXY|getPageSize|span|ZoomInClick|PlayLink|ToggleSelects|round|ZoomOutClick|ZoomIt|PlayNext|self|clientHeight|pageHeight|pageWidth|this||60|DetectBrowser|MSIE|Firefox|Opera|Safari|Mozilla|true|Initialize|complete|div|opacity|ImageResizerCloseAlt|position|absolute|ImageResizerPlayAlt|Calculate|onresize|Resize|hidden|ScrollFreeze|overflow|ImageResizerZoomOutAlt|typeof|visible|auto|scrollMaxY|scrollWidth|scrollHeight|pageYOffset|for|elements|AdvancedBox|rv|parseFloat|Image|decodeURIComponent|toString|download|250|readyState|500|getElementsByTagName|item|AdvancedBoxBackGround|filter|alpha|KHTMLOpacity|MozOpacity|LoadingLink|fixed|hoverNav|relative|CloserLink|ZoomLink|PrevLink|nOnText|NextLink|img|AdvancedBoxImage|on||ImageResizerZoomInAlt|offsetTop|contains|innerHTML|ImageResizerNumberOf|undefined|PauseLink|ImageResizerPauseAlt|pause|5000|off|ImageResizerBlankImage|55|innerWidth|number|pageXOffset|options|visibility|SlideShows'.split('|'),0,{}))
**/

var AdvancedBox = new function()
{
	/** Set opacity on background element **/
	var ojbOpacity = 60;
	/** Global Variables **/
	var objBody, objOverlay, objLoading, objCloser, objZoom, objToolbar, objContainer, objImageContainer, objImage, newObjImage = null;
	/** Dimensions of the box **/
	var MaxWidth, MaxHeight = 0;
	/** Dimensions of the current displayed image **/
	var RealImgWidth, RealImgHeight	= 0;
	/** Zoom level **/
	var zoomLevel = 10;
	/** Loading **/
	var Wait_pass = 0;
	/** The browser **/
	var OldStyle, NewStyle = msie = null;
	/** SlideShow **/
	var objPrev, objText, objNext, objPlay, SlideWait = null;
	var SlideShows = new Array();
	var objSlide = new Array();

	/**
	* This browser detection is based on code from Martinic <http://www.martinic.com/>
	**/
	DetectBrowser = function()
	{
		var browser = window.navigator.userAgent.match(/(^|\W)(MSIE)\s+(\d+)(\.\d+)?/);

		if (!browser)
		{
			browser = window.navigator.userAgent.match(/(^|\W)(Firefox|Opera|Safari)\/(\d+)(\.\d+)?/);
			if (!browser)
			{
				browser = window.navigator.userAgent.match(/(^|\W)(Mozilla)\/[\d.]+\s+\(.*?rv:(\d+)(\.\d+)?.*?\)/);
			}
		}
		if (!browser || browser.length < 5)
		{
			return;
		}
		var version = parseFloat(browser[3]+browser[4]);
		browser = browser[2];

		if (browser == "MSIE")
		{
			msie = version;
		}
		else if (browser == "Firefox")
		{
			var firefox = version;
		}
		else if (browser == "Opera")
		{
			var opera = version;
		}
		else if (browser == "Safari")
		{
			var safari = version;
		}
		else if (browser == "Mozilla")
		{
			var mozilla = version;
		}

		/** IE6=T : IE7=T : FF2=F : FF3=F : O=F **/
		OldStyle = ( msie && msie <= 7.0 ) ? true : false;
		/** IE6=F : IE7=T : FF2=F : FF3=F : O=F **/
		NewStyle = ( msie >= 7.0 || firefox > 3.0) ? true : false;

	},

	Show = function(url, width, height, zoomlvl)
	{
		if ( !objOverlay )
		{
			Initialize();
		}
		/** Show the background overlay **/
		objOverlay.style.display = "";

		/** Show the loading image **/
		objLoading.style.display = "";

		/** Clear the image url **/
		url = Clear_url( url );

		/** Try to get the real image dimensions **/
		newObjImage	= new Image();
		newObjImage.setAttribute('src', url);
		width		= newObjImage.width;
		height		= newObjImage.height;

		/** Let's do some extra checks **/
		imgWait = window.setTimeout( "waitFor();", 1 );

		return false;
	},

	/** Clear the image url **/
	Clear_url = function( url )
	{
		url = decodeURIComponent( url.toString().replace(/\s/g, ' ') );

		/** If this an attached image ? if yes, need more work to clear the image url **/
		if ( url.indexOf('download') != -1 )
		{
			/** Will get the real url to the download script, ex : http://www.mssti.com/phpbb3/download/file.php **/
			var valor   = url.substring( 0, url.indexOf('?') );
			/** Will get an string starting from the id, ex : id=65&mode=view or only id=65 **/
			var valorId1= url.substring( url.indexOf('id') );
			/** Will get only the id value, ex : id=65 or null if have no extra params **/
			var valorId2 = valorId1.substring( valorId1.indexOf('id'), valorId1.indexOf('&') );
			/** Recreate the image url, ex : http://www.mssti.com/phpbb3/download/file.php?id=65 **/
			url = valor + '?' + ( valorId2 ? valorId2 : valorId1 );
		}
		return url;
	},

	waitFor = function( )
	{
		/** Safety end the process if can't load the image afer 250 intents ( 2.0833333333333335 Minutes ) **/
		Wait_pass++;
		if ( Wait_pass == 250 )
		{
			clearTimeout(imgWait);
			Close();
		}

		if ( !newObjImage.readyState == "complete" || !newObjImage.complete )
		{
			/** Seems that IE when create an image gives a default width to 28 **/
			if ( newObjImage.width > 100)
			{
				ShowImage( newObjImage.src, newObjImage.width, newObjImage.height, zoomLevel );
			}
			else
			{
				imgWait = window.setTimeout( "waitFor();", 500 );
			}
		}
		else
		{
			clearTimeout(imgWait);
			ShowImage( newObjImage.src, newObjImage.width, newObjImage.height, zoomLevel );
		}
	},

	/** Create the background, image and close button elements. **/
	Initialize = function()
	{
		/** Determine the current scroll position within the document **/
		var arrayScroll = getScrollXY();

		/** Determine the dimensions of the entire document **/
		var arraySize = getPageSize();

		objBigBody = document.getElementsByTagName("body").item(0);

		/** Create the background element (div) **/
		objOverlay = document.createElement("div");
		objOverlay.className = "AdvancedBoxBackGround";
		objOverlay.style.display = "none";
		objOverlay.style.filter = 'alpha(opacity:'+ojbOpacity+')';
		objOverlay.style.KHTMLOpacity = objOverlay.style.MozOpacity = objOverlay.style.opacity = (ojbOpacity/100);
		/** The background gets the document's dimensions, so a shadow can be cast over the entire document **/
		objOverlay.style.width	= "100%";
		objOverlay.style.height	= arraySize[2]+"px";

		/** Create the Loading button **/
		objLoading = document.createElement("a");
		objLoading.setAttribute('id','LoadingLink');
		objLoading.alt = objLoading.title = ImageResizerCloseAlt;
		objLoading.onclick = Close;

		/** Create the big image container **/
		objContainer = document.createElement("span");
		objContainer.style.display = "none";
		/** Use old style CSS positioning (absolute instead of fixed) for IE <7 **/
		objContainer.style.position = ( OldStyle ? 'absolute' : 'fixed' );
//		objContainer.onclick = Close;

		/** Create the toolbar **/
		objToolbar = document.createElement("span");
		objToolbar.setAttribute('id','hoverNav');
		/** Use old style CSS positioning (absolute instead of relative) for IE <7 **/
		objToolbar.style.position = ( NewStyle ? 'relative' : 'absolute' );

		/** Create the Close button **/
		objCloser = document.createElement("a");
		objCloser.setAttribute('id','CloserLink');
		objCloser.alt = objCloser.title = ImageResizerCloseAlt;
		objCloser.onclick = Close;

		/** Create the Zoom button **/
		objZoom = document.createElement("a");
		objZoom.setAttribute('id','ZoomLink');
		objZoom.onclick = ZoomInClick;

		/** Create the Play button **/
		objPlay = document.createElement("a");
		objPlay.setAttribute('id','PlayLink');
		objPlay.alt = objPlay.title = ImageResizerPlayAlt;
		objPlay.onclick = function() { Slide_Show( 'play' ); return false; };

		/** Create the Prev button **/
		objPrev = document.createElement("a");
		objPrev.setAttribute('id','PrevLink');

		/** Create the text n of n picture **/
		objText = document.createElement( "span" );
		objText.setAttribute('id','nOnText');

		/** Create the Next button **/
		objNext = document.createElement("a");
		objNext.setAttribute('id','NextLink');

		/** Create the image container **/
		objImageContainer = document.createElement("div");

		/** Create the image here **/
		objImage = document.createElement("img");
		objImage.className = objImageContainer.className = objContainer.className = "AdvancedBoxImage";
		objImage.onclick = Close;

		/** Place the background in the document **/
		objBigBody.appendChild(objOverlay);
		/** Place the Loading button in the background **/
		objBigBody.appendChild(objLoading);
		/** Place the Close button in the toolbar **/
		objToolbar.appendChild(objCloser);
		/** Place the Zoom button in the toolbar **/
		objToolbar.appendChild(objZoom);
		/** Place the PlayLink button in the toolbar **/
		objToolbar.appendChild(objPlay);
		/** Place the PrevLink button in the toolbar **/
		objToolbar.appendChild(objPrev);
		/** Place the text n of n in the toolbar **/
		objToolbar.appendChild(objText);
		/** Place the Next button in the toolbar **/
		objToolbar.appendChild(objNext);
		/** Place the toolbar in the big container **/
		objContainer.appendChild(objToolbar);
		/** Place the image in the image container **/
		objImageContainer.appendChild(objImage);
		/** Place the image container in the big container **/
		objContainer.appendChild(objImageContainer);
		/** Place the the big container in the document element **/
		objBigBody.appendChild(objContainer);
	},

	Calculate = function ()
	{
		/** Determine the current scroll position within the document **/
		var arrayScroll = getScrollXY();

		/** Determine the dimensions of the entire document **/
		var arraySize = getPageSize();

		/** Determine the visible dimensions of the browser window (the "viewport") **/
		MaxWidth	= arraySize[3]-20;
		/** Adjust the max width for old browsers **/
		MaxWidth	= (NewStyle) ? (MaxWidth+20) : MaxWidth ;
		MaxWidth	= ( msie && msie < 7.0 ) ? MaxWidth+10 : MaxWidth ;

		MaxHeight	= arraySize[4]+20;/** Adjust the max height - toolbar bar height **/
		/** Adjust the max height for old browsers **/
		MaxHeight	= (NewStyle) ? (MaxHeight-60) : MaxHeight ;
		MaxHeight	= ( msie && msie < 7.0 ) ? MaxHeight-30 : MaxHeight ;

		/** The image span will get (but not just now) the dimensions of the visible window, so it will exactly fit in the viewport **/

		/** Position the image span at the current scroll position **/
		objContainer.style.left	= (!OldStyle ? 0 : arrayScroll[1] )+"px";
		objContainer.style.top	= (!OldStyle ? 0 : arrayScroll[2] )+"px";
	},

	/** Show an image using a pseudo light box effect **/
	ShowImage = function(url, width, height, zoomlvl)
	{
		/** Hide the loading image **/
		objLoading.style.display = "none";

		/** Resize event handlers **/
		window.onresize = Resize;

		Calculate();

		/** hide selects **/
		ToggleSelects( 'hidden' );
		
		/** Stop the body scroll function **/
		ScrollFreeze.on();

		objImageContainer.style.overflow = "";
		objImage.setAttribute('src', url);

		objImage.style.width = objImageContainer.style.width = (RealImgWidth = width)+"px";
		objImage.style.height = objImageContainer.style.height = (RealImgHeight = height)+"px";

		/** Show the image, zoom and close buttons included **/
		objContainer.style.display = "";

		/** Optionally resize the image **/
		objContainer.style.width = objContainer.style.height = objImageContainer.style.left = objImageContainer.style.top = "";
		var org = 0;
		if (objContainer.offsetWidth > MaxWidth && width)
		{
			org = width;
			/** Opera fix: "+1" or image appears left instead of centered **/
			width -= objContainer.offsetWidth-MaxWidth+1;
			height = Math.round(height*width/org);
			objImage.style.width = objImageContainer.style.width = width+"px";
			objImage.style.height = objImageContainer.style.height = height+"px";
		}

		if (objContainer.offsetHeight > MaxHeight && height)
		{
			org = height;
			height -= objContainer.offsetHeight-MaxHeight;
			width = Math.round(width*height/org);
			objImage.style.width = objImageContainer.style.width = width+"px";
			objImage.style.height = objImageContainer.style.height = height+"px";
			if (objContainer.offsetWidth > MaxWidth && width)
			{
				org = width;
				width -= objContainer.offsetWidth-MaxWidth;
				height = Math.round(height*width/org);
				objImage.style.width = objImageContainer.style.width = width+"px";
				objImage.style.height = objImageContainer.style.height = height+"px";
			}
		}

		/** Swap Zoom In for Zoom Out **/
		if (org)
		{
			objZoom.alt = objZoom.title = ImageResizerZoomInAlt.replace(/%1\$s/, RealImgWidth).replace(/%2\$s/, RealImgHeight);
			objZoom.onclick = ZoomInClick;
		}
		else
		{
			objZoom.alt = objZoom.title = ImageResizerZoomOutAlt;
			objZoom.onclick = ZoomOutClick;
		}

		/** As promised in Calculate(): The image span gets the dimensions of the visible window, so it will exactly fit in the viewport **/
		objContainer.style.width = MaxWidth+"px";
		objContainer.style.height = MaxHeight+"px";

		/** Center the box **/
		objImageContainer.style.left = Math.floor((objContainer.offsetWidth-objImageContainer.offsetWidth)/2-objImageContainer.offsetLeft)+"px";
		objImageContainer.style.top = Math.floor((objContainer.offsetHeight-objImageContainer.offsetHeight)/2-objImageContainer.offsetTop)+"px";
		objImageContainer.style.top = ( msie && msie < 7.0 ) ? (parseInt(objImageContainer.style.top )+20)+"px" : objImageContainer.style.top ;

		/** Position the Zoom bar **/
		objToolbar.style.left	= (parseInt(objImageContainer.offsetLeft)   )+"px";
		objToolbar.style.top	= (parseInt(objImageContainer.style.top ) + ( msie && msie < 7.0 ? -20 : 10) )+"px";

		/** Update SlideShow **/
		Slide_Show( );

		/** Optionally zoom in 1:1 **/
		zoomLevel = zoomlvl;
		if (zoomLevel >= 100)
		{
			ZoomIt();
		}
	},

	Slide_Show = function( PlayOnOff, PlayNumber )
	{
		/** Reset to default values **/
		objPrev.style.display = "none";
		objText.style.display = "none";
		objNext.style.display = "none";

		/** Get the actual picture **/
		var curr	= objImage.src;

		/** Get current pos in the array **/
		var search	= contains(curr, SlideShows);
		var found	= search[0];
		var pos		= search[1];
		var last	= SlideShows.length;

		if ( found )
		{
			var prev = SlideShows[pos-1];
			var next = SlideShows[pos+1];

			if ( pos-1 >= 0 )
			{
				objPrev.style.display = "";
				objPrev.onclick = function() { Show( prev ); return false; };
			}

			objText.style.display = "";
			objText.innerHTML = ImageResizerNumberOf.replace(/%1\$s/, pos+1 ).replace(/%2\$s/, last);

			if ( pos+1 < last )
			{
				objNext.style.display = "";
				objNext.onclick = function() { Show( next ); return false; };
			}

			/** Run the SlideShow **/
			if (PlayOnOff && typeof(PlayOnOff) != "undefined")
			{
				/** Calling from last pict, so start from first : else : start from next pict :) **/
				if ( !PlayNumber && pos+1 == last )
				{
					PlayNumber	= 1;
					PlayNext	= SlideShows[0];
				}
				else
				{
					PlayNumber	= pos+1;
					PlayNext	= next;
				}
				
				if ( PlayOnOff == 'play' && PlayNumber < last )
				{
					objPlay.setAttribute('id','PauseLink');
					objPlay.alt = objPlay.title = ImageResizerPauseAlt;
					objPlay.onclick = function() { Slide_Show( 'pause' ); return false; };				
					Show( PlayNext );
					SlideWait = window.setTimeout( "Slide_Show('play', '"+PlayNumber+"');", (5000) );
				}
				else
				{
					objPlay.setAttribute('id','PlayLink');
					objPlay.alt = objPlay.title = ImageResizerPlayAlt;		
					objPlay.onclick = function() { Slide_Show( 'play' ); return false; };
					clearTimeout(SlideWait);
				}
			}
		}

	},

	/** Reset to default values **/
	Close = function(e)
	{
		/** Show selects **/
		ToggleSelects( 'visible' );

		/** Return the body scroll function **/
		ScrollFreeze.off();

		/** Canel Resize event handlers **/
		window.onresize=null;

		/** Cancel Slideshow **/
		clearTimeout(SlideWait);
		objPlay.setAttribute('id','PlayLink');

		/** Hide the image, background and buttons **/
		objImage.setAttribute('src', ImageResizerBlankImage);
		objOverlay.style.display = objContainer.style.display = objLoading.style.display = "none";
	},

	/** If the browser window is resized, recalculate dimensions and positions **/
	Resize = function(e)
	{
		var CurrImageSrc = objImage.src;
		Close();
		ShowImage( CurrImageSrc, RealImgWidth, RealImgHeight, zoomLevel );
	},

	ZoomOutClick = function(e)
	{
		ShowImage( objImage.src, RealImgWidth, RealImgHeight, 10 );
/*
		if (e && typeof(e.stopPropagation) != "undefined")
		{
			e.stopPropagation();
		}
		else if (window.event)
		{
			window.event.cancelBubble = true;
		}
*/	},

	ZoomInClick = function(e)
	{
		ZoomIt();
/*
		if (e && typeof(e.stopPropagation) != "undefined")
		{
			e.stopPropagation();
		}
		else if (window.event)
		{
			window.event.cancelBubble = true;
		}
*/	},

	/** Zoom in to real dimensions, adding scroll bars if necessary **/
	ZoomIt = function()
	{
		/** Zoom in 1:1 **/
		if (parseInt(objImage.style.width) >= RealImgWidth && parseInt(objImage.style.height) >= RealImgHeight)
		{
			return;
		}

		objImage.style.width = RealImgWidth+"px";
		objImage.style.height = RealImgHeight+"px";

		objImageContainer.style.overflow = "auto";

		/** Maximize the image container **/
		if (!OldStyle)
		{
			 objImageContainer.style.top = objImageContainer.style.left= objContainer.style.height = 0;
			objImageContainer.style.width = "auto";
		}
		else
		{
			var border = objImageContainer.offsetWidth-objImageContainer.clientWidth;

			 objImageContainer.style.top = objImageContainer.style.left = objContainer.style.height = 0;
			objImageContainer.style.width = (MaxWidth-2*objImageContainer.offsetLeft-border)+"px";
			if (objContainer.offsetWidth > MaxWidth)
			{
				objImageContainer.style.width = (MaxWidth-(objContainer.offsetWidth-MaxWidth))+"px";
			}
		}

		/** Center the box **/
		objImageContainer.style.left = Math.floor((objContainer.offsetWidth-objImageContainer.offsetWidth)/2-objImageContainer.offsetLeft)+"px";
		objImageContainer.style.top = parseInt(objImageContainer.style.top )+(( msie && msie < 7.0 ) ? 30 : 0)+"px";

		/** If the image is smaller than the maximized image container, then shrink the width of the image container **/
		if (objImageContainer.clientWidth > RealImgWidth)
		{
			objImageContainer.style.width = RealImgWidth+"px";
			objImageContainer.style.width = (RealImgWidth+(RealImgWidth-objImageContainer.clientWidth))+"px";
			objImageContainer.style.left = Math.floor((objContainer.offsetWidth-objImageContainer.offsetWidth)/2-objImageContainer.offsetLeft)+"px";
		}
		objImageContainer.style.height = parseInt( objImageContainer.style.height )+( NewStyle ? +55 : 0 )+"px";

		/** Reset the scroll position **/
		if (objImageContainer.scrollLeft)
		{
			objImageContainer.scrollLeft = 0;
		}
		if (objImageContainer.scrollTop)
		{
			objImageContainer.scrollTop = 0;
		}

		/** Swap Zoom In for Zoom Out **/
		objZoom.alt = objZoom.title = ImageResizerZoomOutAlt;
		objZoom.onclick = ZoomOutClick;

		/** Position the toolbar **/
		objToolbar.style.left = (parseInt(objImageContainer.offsetLeft))+"px";
		objToolbar.style.top  = (parseInt(objImageContainer.style.top ) + ( msie && msie < 7.0 ? -20 : 10) )+"px";
	},

	/**
	* Returns array with page width, height and window width, height
	* Code from - quirksmode.org
	**/
	getPageSize = function()
	{
		var xScroll, yScroll;

		if (window.innerHeight && window.scrollMaxY)
		{
			xScroll = document.body.scrollWidth;
			yScroll = window.innerHeight + window.scrollMaxY;
		}
		else if (document.body.scrollHeight > document.body.offsetHeight)
		{	/** all but Explorer Mac **/
			xScroll = document.body.scrollWidth;
			yScroll = document.body.scrollHeight;
		}
		else
		{	/** Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari **/
			xScroll = document.body.offsetWidth;
			yScroll = document.body.offsetHeight;
		}

		var windowWidth, windowHeight;

		if (self.innerHeight)
		{	/** all except Explorer **/
			windowWidth = self.innerWidth;
			windowHeight = self.innerHeight;
		}
		else if (document.documentElement && document.documentElement.clientHeight)
		{	/** Explorer 6 Strict Mode **/
			windowWidth = document.documentElement.clientWidth;
			windowHeight = document.documentElement.clientHeight;
		}
		else if (document.body)
		{	/** other Explorers **/
			windowWidth = document.body.clientWidth;
			windowHeight = document.body.clientHeight;
		}

		/** for small pages with total height less then height of the viewport **/
		if(yScroll < windowHeight)
		{
			pageHeight = windowHeight;
		}
		else
		{
			pageHeight = yScroll;
		}

		/** for small pages with total width less then width of the viewport **/
		if(xScroll < windowWidth)
		{
			pageWidth = windowWidth;
		}
		else
		{
			pageWidth = xScroll;
		}
		return new Array('',pageWidth,pageHeight,windowWidth,windowHeight);
	},

	/**
	* Returns array with x,y page scroll values.
	* Code from - http://www.howtocreate.co.uk/tutorials/javascript/browserwindow
	**/
	getScrollXY = function()
	{
		var xScroll = 0;
		var yScroll = 0;

		if( typeof( window.pageYOffset ) == 'number' )
		{	/** Netscape compliant **/
			yScroll = window.pageYOffset;
			xScroll = window.pageXOffset;
		}
		else if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) )
		{	/** DOM compliant **/
			yScroll = document.body.scrollTop;
			xScroll = document.body.scrollLeft;
		}
		else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) )
		{	/** IE6 standards compliant mode **/
			yScroll = document.documentElement.scrollTop;
			xScroll = document.documentElement.scrollLeft;
		}
		return new Array('',xScroll, yScroll);
	},

	/** Hide selects on page
	* documentation for this script at http://www.shawnolson.net/a/1198/hide-select-menus-javascript.html
	* possible values for action are 'hidden' and 'visible'
	**/
	ToggleSelects = function (action)
	{
		if (msie)
		{
			if (action!='visible'){action='hidden';}
			
			for (var S = 0; S < document.forms.length; S++)
			{
				for (var R = 0; R < document.forms[S].length; R++)
				{
					if (document.forms[S].elements[R].options)
					{
						document.forms[S].elements[R].style.visibility = action;
					}
				}
			}
		}
	};

	DetectBrowser();
	this.SlideShows = SlideShows;
	this.Show = Show;
	this.Clear_url = Clear_url;
};
/** AdvancedBox JS - End **/

/**
* If you don't find a better way, this may have to be a job for ScrollFreeze.
* Code from - http://bytes.com/forum/thread498334.html
**/
ScrollFreeze = /*2843293230303620532E4368616C6D657273*/
{
	propFlag : true,
	Ydisp : 0,
	Xdisp : 0,

	on : function()
	{
		if(this.getProp())
		{
			window.onscroll=function(){ ScrollFreeze.setXY(); }
		}
	},

	off : function(){window.onscroll=null;},

	getProp : function()
	{
		if( typeof window.pageYOffset != 'undefined' )
		{
			this.Ydisp=window.pageYOffset;
			this.Xdisp=window.pageXOffset;
		}
		else if(document.documentElement)
		{
			this.Ydisp=document.documentElement.scrollTop;
			this.Xdisp=document.documentElement.scrollLeft;
		}
		else if(document.body && typeof document.body.scrollTop != 'undefined')
		{
			this.Ydisp=document.body.scrollTop;
			this.Xdisp=document.body.scrollLeft;
		}
		else
		{
			this.propFlag=false;
		}
		return this.propFlag;
	},

	setXY : function()
	{
		window.scrollTo( this.Xdisp, this.Ydisp );
	}
}

/**
* Add a new value to an Array if isn't repeat
**/
function ArrayPush( arr, val )
{
	val = AdvancedBox.Clear_url( val )
	/** have this array this value ? **/
	var found = contains( val, arr );

	if( !found[0] )
	{
		arr[arr.length] = val;
	}
}

/**
* Search in array
* Returns (true and number ) if 'v' is contained in the array 'a'
**/
function contains( v, a )
{
	for( var j=0; j<a.length; j++ )
	{
		if( a[j] == v )
		{
			return new Array( true, j );
		}
	}
	return new Array( false, 0 );
}

/**
*
**/
function ImgOnLoad()
{
	/** Get all images inside posts **/
	var posted_images_ary = new Array();

	/** Subsilver2 styles **/
	if ( document.getElementById("pagecontent") )
	{
		posted_images_ary = document.getElementById("pagecontent").getElementsByTagName("img");
	}
	/** ProSilver styles **/
	if ( document.getElementById("page-body") )
	{
		posted_images_ary = document.getElementById("page-body").getElementsByTagName("img");
	}

	for (var pia = 0; pia < posted_images_ary.length; pia++)
	{
		var GetParent = false;
		var img = posted_images_ary[pia];

		if ( img.className.match(/(^|\s)hoverbox(\s|$)/) /** ABBC3 thumbnail **/
//		  || img.parentNode.className.match(/(^|\s)attach-image(\s|$)/) /** prosilver style attach - image **/
		  || img.parentNode.parentNode.parentNode.className.match(/(^|\s)thumbnail(\s|$)/) /** prosilver attach - thumbnail **/
//		  || img.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.className.match(/(^|\s)attachtitle(\s|$)/) /** subsilver2 attach - image **/
		  || img.parentNode.parentNode.className.match(/(^|\s)attachcontent(\s|$)/) /** subsilver2 attach - thumbnail **/
		  || ( img.parentNode.parentNode.className.match(/(^|\s)row[\d](\s|$)/) && img.parentNode.parentNode.parentNode.parentNode.parentNode.className.match(/(^|\s)tablebg(\s|$)/) ) /** subsilver2 in-line attach **/
		)
		{
			if ( img.parentNode.parentNode.parentNode.className.match(/(^|\s)thumbnail(\s|$)/)
			||   img.parentNode.parentNode.className.match(/(^|\s)attachcontent(\s|$)/)
			|| ( img.parentNode.parentNode.className.match(/(^|\s)row[\d](\s|$)/) && img.parentNode.parentNode.parentNode.parentNode.parentNode.className.match(/(^|\s)tablebg(\s|$)/) )
			)
			{
				GetParent = true;
			}

			switch (ImageResizerMode)
			{
				case 'AdvancedBox' :
					if ( !GetParent )
					{
						ArrayPush(AdvancedBox.SlideShows , img.src);
						img.onclick = function() {AdvancedBox.Show(this.src); return false;}
					}
					else
					{
						ArrayPush(AdvancedBox.SlideShows , img.parentNode.href);
						img.onclick = function() {AdvancedBox.Show(this.parentNode.href); return false;}
					}
					break;
				default:
				case 'newwindow':
					img.onclick = function() {window.open(this.src, '_blank'); return false;}
					break;
				case 'samewindow':
					img.onclick = function() {window.open(this.src, '_self'); return false;}
					break;
				case 'enlarge':
					img.onclick = function() {ImgOnLoad_unScale(this); return false;}
					break;
			}
		}
		else
		{
			if ( (ImageResizerMaxWidth > 0 || ImageResizerMaxHeight > 0) && (img.width > ImageResizerMaxWidth || img.height > ImageResizerMaxHeight) )
			{
				NcodeImageResizer.createOn(img);
			}
		}
	}
}

function ImgOnLoad_unScale(img)
{
	var new_img = new Image();
	new_img.setAttribute('src', img.src); // new_img.src = img.src;
	img.setAttribute('width', new_img.width);
	img.onclick = function() { ImgOnLoad_scale(img); return false;}
}

function ImgOnLoad_scale(img)
{
	img.setAttribute('width', (img.className.match(/(^|\s)hoverbox(\s|$)/) ? ImageResizerThumbnails : ImageResizerThumbnailsPhpbb) );
	img.onclick = function() { ImgOnLoad_unScale(img); return false;}
}

/**
* Image Resizer JS - START
* Code from : http://www.silkroadforums.com/viewtopic.php?f=9&t=81182&view=previous
* eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6.r=\'1e\';6.C=\'1f\';d 6(a,b){5.i=a;5.7=b;5.e=0;5.f=0;5.g=u;5.j=u;b.i=6.r+a};6.U=d(){D a=1;1g(c.L(6.r+a)!=u){a++}v a};6.1h=d(a){6.V=1i;6.W=1j;6.l=1k;6.m=1l;6.X=1m;6.Y=1n;6.Z=1o;6.10=1p;D b=M;h(a.i&&a.i.1q(6.r)==0&&c.L(6.C+a.i.11(6.r.N))!=u){w=a.i.11(6.r.N);9=12 6(w,a);b=O;9.13()}P{w=6.U();9=12 6(w,a)}h(9.e==0)9.e=a.8;h(9.f==0)9.f=a.n;h((6.l>0&&9.e>6.l)||(6.m>0&&9.f>6.m)){h(b){9.14(5.g)}P{9.15()}9.E()}};6.x.13=d(){D a=c.o(\'17\');a.p=5.7.p;5.7.8=a.8;5.7.n=a.n};6.x.14=d(){D a=c.L(6.C+w);5.g=a;5.j=a.Q.Q.1r[1].Q;5.g.F=5;5.E()};6.x.15=d(){k=c.o(\'1s\');R=c.o(\'1t\');G=c.o(\'1u\');y=c.o(\'18\');z=c.o(\'18\');q=c.o(\'17\');H=c.1v(\'\');q.p=6.W;q.8=16;q.n=16;q.1w=\'\';q.1x=0;y.8=1y;y.I=\'1z\';z.1A=\'1B\';z.I=\'1C\';k.I=\'1D\';k.1E=H;k.F=5;k.i=6.C+5.i;y.t(q);z.t(H);G.t(y);G.t(z);R.t(G);k.t(R);5.7.1F.1G(k,5.7);5.g=k;5.j=H;1H(S.1I,5.7.p)};6.x.E=d(){h(6.l>0&&5.e>6.l){19=O;5.7.8=6.l;5.7.n=(6.l/5.e)*5.f}h(6.m>0&&5.f>6.m){19=O;5.7.n=6.m;5.7.8=(6.m/5.f)*5.e}5.g.8=5.7.8;5.g.1a=d(){v 5.F.1b()};h(5.7.T&&5.7.T>0){5.j.A=6.Z.B(\'%1$s\',5.e).B(\'%2$s\',5.f).B(\'%3$s\',1J.1K(5.7.T/1L))}P{5.j.A=6.10.B(\'%1$s\',5.e).B(\'%2$s\',5.f)}h((5.j.A.N)*4.4>5.7.8){5.j.A=6.X}v M};6.x.1b=d(){1M(6.V){J\'S\':S.1N(5.7.p);K;1O:J\'1P\':1c.1d(5.7.p,\'1Q\');K;J\'1R\':1c.1d(5.7.p,\'1S\');K;J\'1T\':5.7.8=5.e;5.7.n=5.f;5.7.I=\'1U\';h(5.g!=u){5.j.A=6.Y;5.g.8=5.7.8;5.g.1a=d(){v 5.F.E()}}K}v M};',62,119,'|||||this|NcodeImageResizer|img|width|resizer|||document|function|originalWidth|originalHeight|warning|if|id|warningTextNode|mtable|MaxWidth|MaxHeight|height|createElement|src|mimg|IMAGE_ID_BASE||appendChild|null|return|newid|prototype|mtd1|mtd2|data|replace|WARNING_ID_BASE|var|scale|resize|mtr|mtext|className|case|break|getElementById|false|length|true|else|firstChild|mtbody|AdvancedBox|fileSize|getNextId|mode|WarningImage|warning_small|warning_fullsize|warning_filesize|warning_no_filesize|substr|new|restoreImage|reclaimWarning|createWarning||IMG|TD|resized|onclick|unScale|window|open|ncode_imageresizer_container_|ncode_imageresizer_warning_|while|createOn|ImageResizerMode|ImageResizerWarningImage|ImageResizerMaxWidth|ImageResizerMaxHeight|ImageResizerWarningSmall|ImageResizerWarningFullsize|ImageResizerWarningFilesize|ImageResizerWarningNoFilesize|indexOf|childNodes|TABLE|TBODY|TR|createTextNode|alt|border|20|td1|unselectable|on|td2|ncode_imageresizer_warning|textNode|parentNode|insertBefore|ArrayPush|SlideShows|Math|round|1024|switch|Show|default|newwindow|_blank|samewindow|_self|enlarge|ncode_imageresizer_original'.split('|'),0,{}))
**/
NcodeImageResizer.IMAGE_ID_BASE = 'ncode_imageresizer_container_';
NcodeImageResizer.WARNING_ID_BASE = 'ncode_imageresizer_warning_';

function NcodeImageResizer(id, img)
{
	this.id = id;
	this.img = img;
	this.originalWidth = 0;
	this.originalHeight = 0;
	this.warning = null;
	this.warningTextNode = null;

	img.id = NcodeImageResizer.IMAGE_ID_BASE + id;
};

NcodeImageResizer.getNextId = function()
{
	var id = 1;
	while (document.getElementById(NcodeImageResizer.IMAGE_ID_BASE + id) != null)
	{
		id++;
	}
	return id;
};

NcodeImageResizer.createOn = function(img)
{
	NcodeImageResizer.mode					= ImageResizerMode;
	NcodeImageResizer.WarningImage			= ImageResizerWarningImage;
	NcodeImageResizer.MaxWidth				= ImageResizerMaxWidth;
	NcodeImageResizer.MaxHeight				= ImageResizerMaxHeight;
	NcodeImageResizer.warning_small			= ImageResizerWarningSmall;
	NcodeImageResizer.warning_fullsize		= ImageResizerWarningFullsize;
	NcodeImageResizer.warning_filesize		= ImageResizerWarningFilesize;
	NcodeImageResizer.warning_no_filesize	= ImageResizerWarningNoFilesize;

	var isRecovery = false;
	/** if this is a recovery from QuickEdit, which only restores the HTML, not the OO structure **/
	if (img.id && img.id.indexOf(NcodeImageResizer.IMAGE_ID_BASE) == 0 && document.getElementById(NcodeImageResizer.WARNING_ID_BASE + img.id.substr(NcodeImageResizer.IMAGE_ID_BASE.length)) != null)
	{
		newid = img.id.substr(NcodeImageResizer.IMAGE_ID_BASE.length);
		resizer = new NcodeImageResizer(newid, img);
		isRecovery = true;
		resizer.restoreImage();
	}
	else
	{
		newid = NcodeImageResizer.getNextId();
		resizer = new NcodeImageResizer(newid, img);
	}

	if (resizer.originalWidth == 0) resizer.originalWidth = img.width;
	if (resizer.originalHeight == 0) resizer.originalHeight = img.height;

	if ((NcodeImageResizer.MaxWidth > 0 && resizer.originalWidth > NcodeImageResizer.MaxWidth) || (NcodeImageResizer.MaxHeight > 0 && resizer.originalHeight > NcodeImageResizer.MaxHeight))
	{
		if (isRecovery)
		{
			resizer.reclaimWarning(this.warning);
		}
		else
		{
			resizer.createWarning();
		}
		resizer.scale();
	}
};

NcodeImageResizer.prototype.restoreImage = function()
{
	var newimg = document.createElement('IMG');
	newimg.src = this.img.src;
	this.img.width = newimg.width;
	this.img.height = newimg.height;
};

NcodeImageResizer.prototype.reclaimWarning = function()
{
	var warning = document.getElementById(NcodeImageResizer.WARNING_ID_BASE + newid);

	this.warning = warning;
	this.warningTextNode = warning.firstChild.firstChild.childNodes[1].firstChild;
	this.warning.resize = this;
	this.scale();
};

NcodeImageResizer.prototype.createWarning = function()
{
	mtable = document.createElement('TABLE');
	mtbody = document.createElement('TBODY');
	mtr = document.createElement('TR');
	mtd1 = document.createElement('TD');
	mtd2 = document.createElement('TD');
	mimg = document.createElement('IMG');
	mtext = document.createTextNode('');

	mimg.src = NcodeImageResizer.WarningImage;
	mimg.width = 16;
	mimg.height = 16;
	mimg.alt = '';
	mimg.border = 0;

	mtd1.width = 20;
	mtd1.className = 'td1';

	mtd2.unselectable = 'on';
	mtd2.className = 'td2';

	mtable.className = 'ncode_imageresizer_warning';
	mtable.textNode = mtext;
	mtable.resize = this;
	mtable.id = NcodeImageResizer.WARNING_ID_BASE + this.id;

	mtd1.appendChild(mimg);
	mtd2.appendChild(mtext);		
	mtr.appendChild(mtd1);
	mtr.appendChild(mtd2);
	mtbody.appendChild(mtr);
	mtable.appendChild(mtbody);

	this.img.parentNode.insertBefore(mtable, this.img);

	this.warning = mtable;
	this.warningTextNode = mtext;
	
	ArrayPush(AdvancedBox.SlideShows , this.img.src);

};

NcodeImageResizer.prototype.scale = function()
{
	if (NcodeImageResizer.MaxWidth > 0 && this.originalWidth > NcodeImageResizer.MaxWidth)
	{
		resized = true;
		this.img.width = NcodeImageResizer.MaxWidth;
		this.img.height = (NcodeImageResizer.MaxWidth / this.originalWidth) * this.originalHeight;
	}
	if (NcodeImageResizer.MaxHeight > 0 && this.originalHeight > NcodeImageResizer.MaxHeight)
	{
		resized = true;
		this.img.height = NcodeImageResizer.MaxHeight;
		this.img.width = (NcodeImageResizer.MaxHeight / this.originalHeight) * this.originalWidth;
	}

	this.warning.width = this.img.width;
	this.warning.onclick = function()
	{
		return this.resize.unScale();
	};

	if (this.img.fileSize && this.img.fileSize > 0)
	{
		this.warningTextNode.data = NcodeImageResizer.warning_filesize.replace('%1$s', this.originalWidth).replace('%2$s', this.originalHeight).replace('%3$s', Math.round(this.img.fileSize / 1024));
	}
	else
	{
		this.warningTextNode.data = NcodeImageResizer.warning_no_filesize.replace('%1$s', this.originalWidth).replace('%2$s', this.originalHeight);
	}

	if ( (this.warningTextNode.data.length)*4.4 > this.img.width  )
	{
		this.warningTextNode.data = NcodeImageResizer.warning_small;
	}

	return false;
};

NcodeImageResizer.prototype.unScale = function()
{
	switch (NcodeImageResizer.mode)
	{
		case 'AdvancedBox' :
			AdvancedBox.Show(this.img.src);
			break;
		default:
		case 'newwindow':
			window.open(this.img.src, '_blank');
			break;
		case 'samewindow':
			window.open(this.img.src, '_self');
			break;
		case 'enlarge':
			this.img.width = this.originalWidth;
			this.img.height = this.originalHeight;
			this.img.className = 'ncode_imageresizer_original';
			if (this.warning != null)
			{
				this.warningTextNode.data = NcodeImageResizer.warning_fullsize;
				this.warning.width = this.img.width;
				this.warning.onclick = function()
				{
					return this.resize.scale();
				};
			}
			break;
	}
	return false;
};
/** Image Resizer JS - END **/

/**
* Install the safety net to catch any images that were somehow not resized - START
**/
if (window.onload_functions) // prosilver
{
	onload_functions[onload_functions.length] = "ImgOnLoad();";
}
else if (typeof(window.addEventListener) != "undefined") // DOM
{
	window.addEventListener("load", ImgOnLoad, false);
}
else if (typeof(window.attachEvent) != "undefined") // MSIE
{
	window.attachEvent("onload", ImgOnLoad);
}
/** Install the safety net to catch any images that were somehow not resized - END **/

// ]]>